Использование Jabber (XMPP) и плагина для шифрования OTR с помощью клиента Pidgin
---------------------------------------------------------------------------------
* [Что такое, для чего и альтернатива чему](#Что-такое-для-чего-и-альтернатива-чему)
* [Установка Pidgin](#Установка-pidgin)
  * [Debian и основанные на нем (Ubuntu, Linux Mint)](#debian-и-основанные-на-нем-ubuntu-linux-mint)
  * [Windows 7 (Портативная версия)](#windows-7-Портативная-версия)
* [Где создать аккаунт](#Где-создать-аккаунт)
  * [Либертарные технические коллективы](#Либертарные-технические-коллективы)
  * [Публичные серверы XMPP](#Публичные-серверы-xmpp)
* [Создание и использование аккаунта](#Создание-и-использование-аккаунта)
* [Установка плагина OTR для Pidgin](#Установка-плагина-otr-для-pidgin)
  * [Debian и основанные на нем (Ubuntu, Linux Mint)](#debian-и-основанные-на-нем-ubuntu-linux-mint-1)
  * [Windows 7 (Портативная версия)](#windows-7-Портативная-версия-1)
* [Настройка плагина OTR](#Настройка-плагина-otr)
* [Отключение журналирования переписки](#Отключение-журналирования-переписки)
* Чаты (конференции)

### Что такое, для чего и альтернатива чему
Jabber (XMPP) - это открытый протокол для обмена мгновенными сообщениями, который позволяет обеспечивать конфиденциальное общение за счет открытой инфраструктуры. Это означает, что мы сами можем выбрать сервер для своего аккаунта, избежать сохранения и контроля над своей перепиской третьей стороной, которой мы не доверяем (как в случае со Skype), дополнительно использовать средства шифрования OTR (Off-the-Record) для защиты от прослушки.

Использование OTR позволяет передавать по сети всю переписку в зашифрованном виде, дает возможность удостовериться, что ваш собеседник является именно тем, за кого он себя выдает, обеспечивает анонимность в том смысле, что после окончания разговора полученные сообщения нельзя однозначно связать с личностями собеседников, а также гарантирует, что прошлая переписка не будет скомпрометирована, если ваш закрытый ключ окажется в чужих руках.

Мы рассмотрим свободный клиент Pidgin для использования Jabber вместе с плагином OTR.

### Установка Pidgin
#### Debian и основанные на нем (Ubuntu, Linux Mint)
В системах Ubuntu и Linux Mint Pidgin может быть уже установлен. Если приложение не установлено, открываем Terminal и устанавливаем его с помощью команды:

	sudo apt-get install pidgin

#### Windows 7 (Портативная версия)
[Скачиваем](http://portableapps.com/apps/internet/pidgin_portable) портативную версию Pidgin.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-download.png" alt="<Скачиваем Pidgin>"/>
</p>

После скачивания запускаем программу установки приложения _PidginPortable_x.x.x.paf.exe_ (версия программы будет меняться в зависимости от времени скачивания). Выбираем язык.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-installation-language.png" alt="<Выбираем язык>"/>
</p>

В следующих окнах жмем _"Далее"_ и переходим в окно выбора папки установки (а точнее распаковки) программы. Выбираем нужную папку на компьютере или флешке и жмем _"Далее"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-installation-folder.png" alt="<Выбор папки установки программы>"/>
</p>

Нажимаем _"Установить"_, ждем завершения процесса установки, выбираем _"Запустить Pidgin Portable"_ и затем жмем _"Готово"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-installation-done.png" alt="<Запустить Pidgin Portable>"/>
</p>

### Где создать аккаунт
#### Либертарные технические коллективы
Мы рекомендуем пользоваться сервисами, которые предоставляют либертарные технические коллективы. Они заботятся о безопасности предоставляемых сервисов, не связаны с государством и коммерческими структурами, а также имеют определенную репутацию и доверие среди множества активистов со всего мира.

Ниже приведена таблица коллективов, предоставляющих jabber-аккаунт, с указанием доменов для выбора и описанием как создать аккаунт.

<table>
    <tr valign="top">
        <td><b>Коллектив</b></td>
        <td colspan="2"><b>Варианты домена</b></td>
        <td><b>Как создать аккаунт</b></td>
    </tr>
    <tr valign="top">
        <td><a href="https://riseup.net">Riseup</a></td>
        <td colspan="2">riseup.net</td>
        <td>Подать <a href="https://user.riseup.net/forms/new_user/first">запрос на создание аккаунта</a> (будет создан почтовый ящик и одновременно jabber-аккаунт с таким же именем); ввести 2 кода-приглашения от уже существующих аккаунтов или подождать несколько дней</td>
    </tr>
    <tr valign="top">
        <td><a href="https://www.autistici.org">Autistici/Inventati</a>&nbsp;&nbsp;&nbsp;</td>
        <td>autistici.org<br>onenetbeyond.org<br>paranoici.org<br>hacari.com<br>hacari.net<br>insicuri.net<br>logorroici.org<br>stronzi.org<br>grrlz.net<br>anche.no<br>krutt.org<br>autoproduzioni.net<br>distruzione.org<br></td>
        <td>inventati.org<br>bastardi.net<br>hacari.org<br>insiberia.net<br>bruttocarattere.org<br>mortemale.org<br>autistiche.org<br>canaglie.org<br>canaglie.net<br>subvertising.org<br>cryptolab.net<br>privacyrequired.com</td>
        <td>Подать <a href="https://www.autistici.org/services">запрос на создание почтового ящика</a> (jabber-аккаунт с таким же именем будет создан автоматически)</td>
    </tr>
    <tr valign="top">
        <td><a href="http://entodaspartes.org/">en todas partes!</a></td>
        <td  colspan="2">entodaspartes.org</td>
        <td>Аккаунт создается через клиент</td>
    </tr>
    <tr valign="top">
        <td><a href="https://www.systemli.org">systemli.org</a></td>
        <td colspan="2">jabber.systemli.org</td>
        <td>Аккаунт создается через клиент с перенаправлением на сайт, где нужно ввести пароль от создаваемого аккаунта (+ есть защита от спама)</td>
    </tr>
    <tr valign="top">
        <td><a href="https://www.free.de">Free!</a></td>
        <td colspan="2">free.de</td>
        <td><a href="https://faq.free.de/?action=register">Зарегистрироваться</a> для получения почтового ящика и автоматически jabber-аккаунта с таким же именем</td>
    </tr>
    <tr valign="top">
        <td><a href="https://www.immerda.ch">immerda</a></td>
        <td colspan="2">imsg.ch</td>
        <td>Нужно написать письмо администраторам для создания почтового ящика (<a href="https://wiki.immerda.ch/index.php/immerda:NewEmail">шаблонное письмо</a> на адрес <i>admin ( at ) immerda.ch</i>), после чего <a href="https://www.imsg.ch/main.py?cmd=mail_form">зарегистрировать</a> jabber-аккаунт</td>
    </tr>
</table>

#### Публичные серверы XMPP
Если по каким-либо причинам вы не хотите создавать аккаунт, связанный с либертарными коллективами, вы можете воспользоваться любым сервером из этого [списка публичных серверов XMPP](https://list.jabber.at). Из этого списка мы рекомендуем использовать **jabber.ccc.de**. Создать аккаунт можно также на **dukgo.com** или **draugr.de**.

### Создание и использование аккаунта
При первом запуске Pidgin мы увидим окно приветствия.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-welcome.png" alt="<Добро пожаловать в Pidgin!>"/>
</p>

Жмем _"Добавить..."_ и переходим в окно добавления учетной записи.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-new.png" alt="<Добавить учетную запись>"/>
</p>

Заполняем поля следующим образом:<br/>
* _Протокол_: XMPP<br/>
* _Имя пользователя_: уникальное имя пользователя вашего аккаунта (до символа @); мы напоминаем, что оно не должно содержать ваших реальных данных (имя, фамилия, дата рождения и т.д.)<br/>
* _Домен_: название домена сервера XMPP (см. [Публичные серверы XMPP](#Публичные-серверы-xmpp) или таблицу с информацией о вариантах доменов различных [либертарных технических коллективов](#Либертарные-технические-коллективы))<br/>
* _Ресурс_: необязательное поле; если вы пользуетесь своим jabber-аккаунтом в различных местах или с помощью различных устройств, вы можете указать в этом поле к примеру work, home, android и т.д.<br/>
* _Пароль / Запомнить пароль_: пароль от вашего аккаунта; мы рекомендуем не вводить здесь пароль и не указывать, чтобы клиент его запоминал, т.к. если злоумышленник получит доступ к вашей системе, то он не сможет автоматически зайти под вашим jabber-аккаунтом

Если вы создаете новый аккаунт с помощью самого клиента (напр., в случае _dukgo.com_ или _draugr.de_), вам нужно выбрать _"Создать эту новую учетную запись на сервере"_.

Заполнение остальных параметров пользователя остается на ваше усмотрение.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-add-account.png" alt="<Добавить учетную запись>"/>
</p>

Перейдя на вкладку _"Дополнительно"_ убедитесь, что значение поля _"Безопасность соединения"_ установлено в _"Требовать шифрование"_. Порт соединение остается _5222_. _"Прокси передачи файлов"_ можно изменить на **proxy.riseup.net**. В конце жмем на кнопку _"Добавить"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-advanced.png" alt="<Дополнительно>"/>
</p>

Если вы создавали аккаунт с помощью клиента, то должно появиться окно для регистрации новой учетной записи, в котором вы указываете имя пользователя и пароль для вашего аккаунта и жмете _"Зарегистрировать"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-create-account.png" alt="<Зарегистрировать новую учетную запись>"/>
</p>

В случае успешной регистрации вы увидите подтверждение.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-successful-registration.png" alt="<Регистрация завершена успешно>"/>
</p>

Если регистрацию выполнить не удалось, то вы увидите уведомление с пояснением причины: напр., имя пользователя может быть уже занято (конфликт имен) или сервер в данный момент может быть перегружен.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-registration-conflict.png" alt="<Конфликт>"/>&nbsp;&nbsp;&nbsp;
  <img src="/images/jabber-otr-pidgin/pidgin-server-overload.png" alt="<Сервер перегружен>"/>
</p>

Чтобы начать пользоваться новым аккаунтом, в появившемся окне учетных записей выбираем нашу запись, вводим пароль и жмем _"OK"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-login.png" alt="<Введите пароль>"/>
</p>

Теперь, когда статус вашего аккаунта изменился на _"Доступен"_, вы можете добавить собеседника или чат в ваш список собеседников, сгруппировать их в вашем списке (добавить группу) или сказать вашим собеседникам, чтобы добавили вас. Можно указать, чтобы в списке отображались собеседники не в сети, пустые группы и прочее.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-contact-list.png" alt="<Список собеседников>"/>
</p>

Добавляя собеседника в ваш список контактов, вам следует в поле _"Имя пользователя собеседника"_ указать полное название аккаунта. Опционально можете указать под каким именем в вашем списке будет отображаться новый собеседник (поле _"Псевдоним"_), пригласительное сообщение, а также добавить собеседника в какую-либо группу.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-add-buddy.png" alt="<Добавить собеседника>"/>
</p>

### Установка плагина OTR для Pidgin
#### Debian и основанные на нем (Ubuntu, Linux Mint)
Вводим в Terminal'е следующую команду:

	sudo apt-get install pidgin-otr

#### Windows 7 (Портативная версия)
[Скачиваем](http://portableapps.com/apps/internet/pidgin_portable) плагин OTR (на данный момент это файл _Pidgin-OTR_Portable_4.0.0-1.paf.exe_).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-otr-download.png" alt="<Скачиваем плагин>"/>
</p>

Процесс установки такой же, как и при установке самого Pidgin, в том числе **следует указать ту же папку установки**.

### Настройка плагина OTR
Чтобы активизировать плагин OTR проходим в меню _"Средства -> Модули"_, выбираем _"Off-the-Record (OTR)"_ и нажимаем _"Настроить модуль"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-plugin-otr.png" alt="<Модуль Off-the-Record (OTR)>"/>
</p>

В настройках модуля нажимаем _"Создать"_ в блоке _"Мои закрытые ключи"_. После этого будет сгенерирован криптографический ключ для безопасного общения. Создание закрытого ключа может занять продолжительное время в зависимости от ресурсов вашего компьютера, поэтому не спешите закрывать Pidgin даже если вам показалось, что он завис.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-plugin-keygen.png" alt="<Создаем закрытый ключ>"/>
</p>

После генерации ключа плагин для шифрования OTR готов к использованию. Для этого в окне общения с собеседником нажмите на появившуюся опцию _"Не защищено"_ и выберите _"Начать защищенный разговор"_. После этого в вашем окне появится сообщение _"Попытка начать защищенный разговор с ..."_. Если у собеседника установлен OTR, то статус будет изменен с _"Не защищено"_ на _"Не идентиф."_. Это означает, что собеседник еще не подтвердил свою личность. Данная мера создана для того, чтобы вы наверняка были уверены, что общаетесь именно с тем собеседником, с которым и хотели.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-unverified.png" alt="<Попытка начать защищенный разговор>"/>
</p>

Чтобы подтвердить личность собеседника выберите в меню окна _"OTR -> Аутентифицированный контакт"_. Существует 3 способа подтвердить личность собеседника:

- _Вопрос и ответ_<br/>
Вы задаете вашему собеседнику такой вопрос, на который знаете ответ только вы и ваш собеседник. Только в случае ввода правильного ответа на ваш вопрос ваш собеседник подтвердит свою личность (однако это не означает, что вы подтвердите свою личность для вашего собеседника).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-q-n-a.png" alt="<Вопрос и ответ>"/>
</p>

- _Общий секрет_<br/>
Вам и вашему собеседнику нужно ввести общий секретный ключ, известный только вам. В этом случае либо оба собеседника подтвердят личности друг друга, либо оба не подтвердят.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-shared-key.png" alt="<Общий секрет>"/>
</p>

- _Самостоятельная проверка отпечатка_<br/>
Вы можете связаться с вашим собеседником по другому каналу (напр., по почте с использованием GPG или предварительно при личной встрече) и сообщить ему свой отпечаток / полное имя вашего аккаунта. Если отпечаток / аккаунт совпадает, выберите "Я проверил(а)" и нажмите "Authenticate".

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-fingerprint.png" alt="<Самостоятельная проверка отпечатка>"/>
</p>

Когда личность вашего собеседника будет подтвеждена, статус изменится на _"Защищено"_. Теперь вы точно знаете, что общаетесь не с самозванцем.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-private.png" alt="<Защищено>"/>
</p>

### Отключение журналирования переписки
Несмотря на то, что вся переписка сейчас будет передаваться по сети в зашифрованном виде, в Pidgin по умолчанию включено журналирование вашей переписки со всеми собеседниками, т.е. она хранится на вашем компьютере в файлах журнала в незашифрованном виде. Получив доступ к вашему компьютеру, злоумышленник сможет ее прочесть. Мы настоятельно рекомендуем отключить ведение журналов вашей переписки в Pidgin. Для этого выбираем в меню _"Средства -> Настройки"_, переходим на закладку _"Журналы"_ и снимаем все галочки.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-preferences-logging.png" alt="<Отключение журналирования переписки>"/>
</p>

Начиная разговор с вашим собеседником, убедитесь также, что журнал для этого конкретного разговора не ведется (для этого в меню окна _"Параметры -> Вести журнал"_ не должно быть галочки).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-disable-logging.png" alt="<Отключение ведения журнала разговора>"/>
</p>

Проверить наличие журналов переписки (и при желании удалить их) можно в папке:
- `C:\Users\<username>\AppData\Roaming\` в Windows 7
- `/home/<username>/.purple` в Debian и основанных на нем

### Чаты (конференции)
Протокол Jabber позволяет создавать чат-комнаты (конференции) для одновременного общения множества собеседников.
