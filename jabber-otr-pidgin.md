Использование Jabber (XMPP) и плагина для шифрования OTR с помощью клиента Pidgin
---------------------------------------------------------------------------------
* [Что такое, для чего и альтернатива чему](#Что-такое-для-чего-и-альтернатива-чему)
* [Установка Pidgin](#Установка-pidgin)
  * [Debian и основанные на нем (Ubuntu, Linux Mint)](#debian-и-основанные-на-нем-ubuntu-linux-mint)
  * [Windows 7](#windows-7)
* [Где создать аккаунт](#Где-создать-аккаунт)
  * [Либертарные технические коллективы](#Либертарные-технические-коллективы)
  * [Публичные серверы XMPP](#Публичные-серверы-xmpp)
* [Создание и использование аккаунта](#Создание-и-использование-аккаунта)
* [Установка плагина OTR для Pidgin](#Установка-плагина-otr-для-pidgin)
  * [Debian и основанные на нем (Ubuntu, Linux Mint)](#debian-и-основанные-на-нем-ubuntu-linux-mint-1)
  * [Windows 7](#windows-7-1)
* [Настройка плагина OTR](#Настройка-плагина-otr)
* [Отключение журналирования переписки](#Отключение-журналирования-переписки)
* [Чаты (конференции)](#Чаты-конференции)
* [Анонимизация через TOR](#Анонимизация-через-tor)
  * [Локальный прокси-сервер](#Локальный-прокси-сервер)
  * [Скрытая служба от Riseup](#Скрытая-служба-от-riseup)

### Что такое, для чего и альтернатива чему
Jabber (XMPP) - это открытый протокол для обмена мгновенными сообщениями, который позволяет обеспечивать конфиденциальное общение за счет открытой инфраструктуры. Это означает, что мы сами можем выбрать сервер для своего аккаунта (и связываться с ним только по защищенному каналу), избежать сохранения и контроля над своей перепиской третьей стороной, которой мы не доверяем (как в случае со Skype), дополнительно использовать средства шифрования переписки OTR (Off-the-Record) для защиты от прослушки, а также анонимизацию через TOR.

Использование OTR позволяет передавать по сети всю переписку в зашифрованном виде, дает возможность удостовериться, что ваш собеседник является именно тем, за кого он себя выдает, обеспечивает анонимность в том смысле, что после окончания разговора полученные сообщения нельзя однозначно связать с личностями собеседников, а также гарантирует, что прошлая переписка не будет скомпрометирована, если ваш закрытый ключ окажется в чужих руках.

Мы рассмотрим свободный клиент [Pidgin](https://help.riseup.net/ru/chat/clients#recommended-clients) для использования Jabber вместе с плагином OTR.

### Установка Pidgin
#### Debian и основанные на нем (Ubuntu, Linux Mint)
В данных системах Pidgin может быть уже установлен. Если приложение не установлено, открываем Terminal и устанавливаем его с помощью команды:

	sudo apt-get install pidgin

#### Windows 7
Скачиваем Pidgin с [официального сайта](https://pidgin.im/download/windows).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-download.png" alt="<Скачиваем Pidgin>"/>
</p>

Запускаем программу установки приложения _pidgin-2.10.9.exe_ (версия программы может быть более поздней). Выбираем язык.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-installation-language.png" alt="<Выбираем язык>"/>
</p>

В следующих окнах жмем _"Далее"_ и переходим в окно выбора компонентов устанавливаемой программы. Здесь в случае необходимости можно добавить нужный язык в компоненте _"Поддержка проверки орфографии"_. 

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-installation-spellchecking.png" alt="<Компоненты устанавливаемой программы>"/>
</p>

Выбираем папку установки.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-installation-folder.png" alt="<Выбор папки установки программы>"/>
</p>

Нажимаем _"Установить"_ и ждем завершения процесса установки.

### Где создать аккаунт
#### Либертарные технические коллективы
Мы рекомендуем пользоваться сервисами, которые предоставляют либертарные технические коллективы. Они заботятся о безопасности предоставляемых сервисов, не связаны с государством и коммерческими структурами, а также имеют определенную репутацию и доверие среди множества активистов со всего мира.

Ниже приведена таблица коллективов, предоставляющих jabber-аккаунт, с указанием доменов для выбора и описанием как создать аккаунт.

<table>
  <tr valign="top">
    <td><b>Коллектив</b></td>
    <td colspan="2"><b>Варианты домена</b></td>
    <td><b>Как создать аккаунт</b></td>
  </tr>
  <tr valign="top">
    <td><a href="https://riseup.net">Riseup</a></td>
    <td colspan="2">riseup.net</td>
    <td>Подать <a href="https://user.riseup.net/forms/new_user/first">запрос на создание аккаунта</a> (будет создан почтовый ящик и одновременно jabber-аккаунт с таким же именем); ввести 2 кода-приглашения от уже существующих аккаунтов или подождать несколько дней</td>
  </tr>
  <tr valign="top">
    <td><a href="https://www.autistici.org">Autistici/Inventati</a>&nbsp;&nbsp;&nbsp;</td>
    <td>autistici.org<br>onenetbeyond.org<br>paranoici.org<br>hacari.com<br>hacari.net<br>insicuri.net<br>logorroici.org<br>stronzi.org<br>grrlz.net<br>anche.no<br>krutt.org<br>autoproduzioni.net<br>distruzione.org<br></td>
    <td>inventati.org<br>bastardi.net<br>hacari.org<br>insiberia.net<br>bruttocarattere.org<br>mortemale.org<br>autistiche.org<br>canaglie.org<br>canaglie.net<br>subvertising.org<br>cryptolab.net<br>privacyrequired.com</td>
    <td>Подать <a href="https://www.autistici.org/services">запрос на создание почтового ящика</a> (jabber-аккаунт с таким же именем будет создан автоматически)</td>
  </tr>
  <tr valign="top">
    <td><a href="http://entodaspartes.org/">en todas partes!</a></td>
    <td colspan="2">entodaspartes.org</td>
    <td>Аккаунт создается через клиент</td>
  </tr>
  <tr valign="top">
    <td><a href="https://www.systemli.org">systemli.org</a></td>
    <td colspan="2">jabber.systemli.org</td>
    <td>Аккаунт создается через клиент с перенаправлением на сайт, где нужно ввести пароль от создаваемого аккаунта (+ есть защита от спама)</td>
  </tr>
  <tr valign="top">
    <td><a href="https://www.free.de">Free!</a></td>
    <td colspan="2">free.de</td>
    <td><a href="https://faq.free.de/?action=register">Зарегистрироваться</a> для получения почтового ящика и автоматически jabber-аккаунта с таким же именем</td>
  </tr>
  <tr valign="top">
    <td><a href="https://www.immerda.ch">immerda</a></td>
    <td colspan="2">imsg.ch</td>
    <td>Нужно написать письмо администраторам для создания почтового ящика (<a href="https://wiki.immerda.ch/index.php/immerda:NewEmail">шаблонное письмо</a> на адрес <i>admin ( at ) immerda.ch</i>), после чего <a href="https://www.imsg.ch/main.py?cmd=mail_form">зарегистрировать</a> jabber-аккаунт</td>
  </tr>
</table>

#### Публичные серверы XMPP
Если по каким-либо причинам создание аккаунта, связанного с либертарными коллективами, недопустимо, можно воспользоваться любым сервером из этого [списка публичных серверов XMPP](https://list.jabber.at). Из этого списка мы рекомендуем использовать `jabber.ccc.de`. Создать аккаунт можно также на `dukgo.com` или `draugr.de`.

### Создание и использование аккаунта
При первом запуске Pidgin мы увидим окно приветствия.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-welcome.png" alt="<Добро пожаловать в Pidgin!>"/>
</p>

Жмем _"Добавить..."_ и переходим в окно добавления учетной записи.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-new.png" alt="<Добавить учетную запись>"/>
</p>

На вкладке _"Основные"_ заполняем поля следующим образом:<br/>
* _Протокол_: `XMPP`
* _Имя пользователя_: `уникальное имя пользователя` вашего аккаунта (до символа @); мы напоминаем, что оно не должно содержать ваших реальных данных (имя, фамилия, дата рождения и т.д.)
* _Домен_: `название домена` сервера XMPP (см. [Публичные серверы XMPP](#Публичные-серверы-xmpp) или таблицу с информацией о вариантах доменов различных [либертарных технических коллективов](#Либертарные-технические-коллективы))
* _Ресурс_: необязательное поле; в случае использования jabber-аккаунта в различных местах или с помощью различных устройств, можно указать в этом поле к примеру `work`, `home`, `android` и т.д.
* _Пароль / Запомнить пароль_: `пароль` от вашего аккаунта; мы рекомендуем не вводить здесь пароль и не указывать, чтобы клиент его запоминал, т.к. если злоумышленник получит доступ к вашей системе, то он не сможет автоматически зайти под вашим jabber-аккаунтом

При создании нового аккаунта с помощью самого клиента (напр., в случае _dukgo.com_ или _draugr.de_), нужно выбрать _"Создать эту новую учетную запись на сервере"_.

Заполнение остальных параметров пользователя остается на ваше усмотрение.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-add-account.png" alt="<Добавить учетную запись>"/>
</p>

Перейдя на вкладку _"Дополнительно"_ приступим в настройке параметров безопасности:
* _Безопасность соединения_: проверяем, что значение поля установлено в `Требовать шифрование`<br />
![<Важно!>](/images/a-star.png) _**эта опция очень важна, т.к. гарантирует, что связь с сервером будет осуществляться только по защищенному каналу с помощью SSL/TLS, а также то, что пароль от вашего аккаунта не будет перехвачен**_
* _Соединяться на порт_: оставляем `5222`
* _Прокси передачи файлов_: `proxy.riseup.net`

Использование поля _"Соединяться с сервером"_, а также настройки вкладки _"Прокси"_ будут рассмотрены чуть позже в разделе [Анонимизация через TOR](#Анонимизация-через-tor). А пока жмем на кнопку _"Добавить"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-advanced.png" alt="<Дополнительно>"/>
</p>

Если аккаунт был создан с помощью клиента, то должно появиться окно для регистрации новой учетной записи, в котором нужно указать имя пользователя и пароль для вашего аккаунта и нажать _"Зарегистрировать"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-create-account.png" alt="<Зарегистрировать новую учетную запись>"/>
</p>

В случае успешной регистрации появится подтверждение.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-successful-registration.png" alt="<Регистрация завершена успешно>"/>
</p>

Если регистрацию выполнить не удалось, то появится уведомление с пояснением причины: напр., имя пользователя может быть уже занято (конфликт имен) или сервер в данный момент может быть перегружен.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-registration-conflict.png" alt="<Конфликт>"/>&nbsp;&nbsp;&nbsp;
  <img src="/images/jabber-otr-pidgin/pidgin-server-overload.png" alt="<Сервер перегружен>"/>
</p>

Чтобы начать пользоваться новым аккаунтом, в появившемся окне учетных записей выбираем аккаунт, вводим пароль и жмем _"OK"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-login.png" alt="<Введите пароль>"/>
</p>

Теперь, когда статус аккаунта изменился на _"Доступен"_, можно добавить собеседника или чат в список собеседников, сгруппировать их (добавить группу) или сказать вашим собеседникам, чтобы добавили вас. Можно указать, чтобы в списке отображались собеседники не в сети, пустые группы и прочее.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-contact-list.png" alt="<Список собеседников>"/>
</p>

Добавляя собеседника в ваш список контактов, вам следует в поле _"Имя пользователя собеседника"_ указать полное название аккаунта. Опционально можете указать под каким именем в вашем списке будет отображаться новый собеседник (поле _"Псевдоним"_), пригласительное сообщение, а также добавить собеседника в какую-либо группу.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-add-buddy.png" alt="<Добавить собеседника>"/>
</p>

### Установка плагина OTR для Pidgin
#### Debian и основанные на нем (Ubuntu, Linux Mint)
Вводим в Terminal'е следующую команду:

	sudo apt-get install pidgin-otr

#### Windows 7
Скачиваем плагин OTR с [сайта разработчиков](https://otr.cypherpunks.ca/index.php#downloads) (на данный момент это файл _pidgin-otr-4.0.0-1.exe_).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-otr-download.png" alt="<Скачиваем плагин>"/>
</p>

Процесс установки предельно простой, просто проходимся по всем шагам установки и жмем "Далее".

### Настройка плагина OTR
Чтобы активизировать плагин OTR проходим в меню _"Средства -> Модули"_, выбираем _"Off-the-Record (OTR)"_ и нажимаем _"Настроить модуль"_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-plugin-otr.png" alt="<Модуль Off-the-Record (OTR)>"/>
</p>

В настройках модуля нажимаем _"Создать"_ в блоке _"Мои закрытые ключи"_. После этого будет сгенерирован криптографический ключ для безопасного общения. Создание закрытого ключа может занять продолжительное время в зависимости от ресурсов вашего компьютера, поэтому не спешите закрывать Pidgin даже если вам показалось, что он завис.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-plugin-keygen.png" alt="<Создаем закрытый ключ>"/>
</p>

После генерации ключа плагин для шифрования OTR готов к использованию. Для этого в окне общения с собеседником нажимаем на появившуюся опцию _"Не защищено"_ и выбираем _"Начать защищенный разговор"_. После этого в окне появится сообщение _"Попытка начать защищенный разговор с ..."_. Если у собеседника установлен OTR, то статус будет изменен с _"Не защищено"_ на _"Не идентиф."_. Это означает, что собеседник еще не подтвердил свою личность. Данная мера создана для того, чтобы вы наверняка были уверены, что общаетесь именно с тем собеседником, с которым и хотели.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-unverified.png" alt="<Попытка начать защищенный разговор>"/>
</p>

Чтобы подтвердить личность собеседника выбираем в меню окна _"OTR -> Аутентифицированный контакт"_. Существует 3 способа подтвердить личность собеседника:

* _Вопрос и ответ_<br/>
Вы задаете вашему собеседнику такой вопрос, на который знаете ответ только вы и ваш собеседник. Только в случае ввода правильного ответа на ваш вопрос ваш собеседник подтвердит свою личность (однако это не означает, что вы подтвердите свою личность для вашего собеседника).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-q-n-a.png" alt="<Вопрос и ответ>"/>
</p>

* _Общий секрет_<br/>
Вам и вашему собеседнику нужно ввести общий секретный ключ, известный только вам. В этом случае либо оба собеседника подтвердят личности друг друга, либо оба не подтвердят.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-shared-key.png" alt="<Общий секрет>"/>
</p>

* _Самостоятельная проверка отпечатка_<br/>
Вы можете связаться с вашим собеседником по другому конфиденциальному каналу (напр., по почте с использованием GPG или предварительно при личной встрече) и сообщить ему свой отпечаток / полное имя вашего аккаунта. Если отпечаток / аккаунт совпадает, выберите "Я проверил(а)" и нажмите "Authenticate".

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-fingerprint.png" alt="<Самостоятельная проверка отпечатка>"/>
</p>

Когда личность вашего собеседника будет подтвеждена, статус изменится на _"Защищено"_. Теперь вы точно знаете, что общаетесь не с самозванцем.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-buddy-private.png" alt="<Защищено>"/>
</p>

### Отключение журналирования переписки
Несмотря на то, что вся переписка сейчас будет передаваться по сети в зашифрованном виде, в Pidgin по умолчанию включено журналирование вашей переписки со всеми собеседниками, т.е. она хранится на вашем компьютере в файлах журнала в незашифрованном виде. Получив доступ к вашему компьютеру, злоумышленник сможет ее прочесть. Мы настоятельно рекомендуем отключить ведение журналов вашей переписки в Pidgin. Для этого выбираем в меню _"Средства -> Настройки"_, переходим на закладку _"Журналы"_ и снимаем все галочки.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-preferences-logging.png" alt="<Отключение журналирования переписки>"/>
</p>

Начиная разговор с вашим собеседником, убедитесь также, что журнал для этого конкретного разговора не ведется (для этого в меню окна _"Параметры -> Вести журнал"_ не должно быть галочки).

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-disable-logging.png" alt="<Отключение ведения журнала разговора>"/>
</p>

Проверить наличие журналов переписки (и при желании удалить их) можно в папке:
* `C:\Users\<username>\AppData\Roaming\` в Windows 7
* `/home/<username>/.purple` в Debian и основанных на нем

### Чаты (конференции)
Протокол Jabber позволяет создавать чат-комнаты (конференции) для одновременного общения множества собеседников. Чтобы создать новый чат или присоединиться к уже существующему, нужно выбрать в меню _"Собеседники -> Присоединиться к чату..."_. В появившемся окне вводим название чата (поле _"Комната"_), сервер, где будет распологаться чат, ваш псевдоним в чате (поле _"Имя"_) и пароль для входа в чат. Как правило, поле _"Сервер"_ заполняется автоматически, но вы также можете выбрать любой севрер для чата, который предпочитаете. Ниже в качестве рекомендации приведен небольшой список серверов либертарных коллективов:

* `conference.riseup.net`
* `conference.jabber.autistici.org`
* `conference.im.mayfirst.org`

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-join-chat.png" alt="<Присоединиться к чату>"/>
</p>

После нажатия на _"Присоединиться"_ вы попадете в чат. Сообщите конфиденциально остальным собеседникам название комнаты, сервер и пароль, чтобы они тоже присоединились к беседе.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-chat-room.png" alt="<Комната>"/>
</p>

![<Важно!>](/images/a-star.png) _**Помните, что переписка в чате плагином OTR не шифруется!**_

Чтобы обезопасить свое общение в чате:
* убедитесь, что каждый собеседник чата при настройке своего аккаунта установил значение поля _"Безопасность соединения"_ в `Требовать шифрование`
* настройте [анонимизацию через TOR](#Анонимизация-через-tor)
* пользуйтесь VPN

### Анонимизация через TOR
Для анонимизации (т.е. сокрытия вашего реального IP-адреса) Tor должен быть включен все время работы Pidgin.

#### Локальный прокси-сервер
Запускаем Tor Browser, нажимаем на _кнопку с луковицей_, выбираем _"Настройки"_ и смотрим _параметры прокси_.

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-tor-network-settings.png" alt="<Параметры прокси>"/>
</p>

Данные параметры прокси нужно ввести в настройках учетной записи на вкладке _"Прокси"_ и перезайти в аккаунт.

* SOCKS хост: `127.0.0.1`
* Тип прокси: `SOCKS 5`
* Порт: `9150`

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-proxy-local-tor.png" alt="<Параметры прокси для локального TOR'а>"/>
</p>

#### Скрытая служба от Riseup
Для аккаунтов, созданных на Riseup, доступно использование скрытой службы TOR. Для этого в настройках учетной записи на вкладке _"Дополнительно"_ в поле _"Соединяться с сервером"_ нужно прописать `4cjw6cwpeaeppfqz.onion`, а на вкладке _"Прокси"_ следующие значения и перезайти в аккаунт:

* Тип прокси: `SOCKS 5`
* Узел: `127.0.0.1`
* Порт: `9150`
* Имя пользователя: `имя пользователя` аккаунта на Riseup
* Пароль: `пароль` аккаунта на Riseup

<p align="center">
  <img src="/images/jabber-otr-pidgin/pidgin-account-proxy-hidden-service.png" alt="<Параметры прокси для скрытого сервиса Riseup>"/>
</p>
